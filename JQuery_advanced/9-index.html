<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8" />
  <title>Task 0</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <style>
    .loading {
      opacity: 0.2;
    }
  </style>
</head>

<body>
  <script type="application/javascript">
    function createSearchForm() {
      const $input = $('<input>', {type: 'text'});
      const $submit = $('<input>', {type: 'submit', value: 'Search'});
      const $form =$('<form>').append($input, $submit);
      const $ul = $('<ul>');

      $('body').append($form, $ul);

      $form.submit(function(e) {
        e.preventDefault();
        const $searchTerm = $input.val().trim();
        if ($searchTerm != ' '){
          queryWikipedia($searchTerm);
        }
      })
    }

      function addNewArticle(id, title, snippet){
        const $li =$('<li>');
        const $p1 = $('<p>').html(`<span>${id} - </span><b>${title}</b>`);
        const $p2 = $('<p>').html(snippet);
        $li.append($p1, $p2);
        $('ul').append($li);
      }
      
      function queryWikipedia(search) {
      const url = 'https://en.wikipedia.org/w/api.php';
      const data = {
        action: 'query',
        list: 'search',
        srsearch: search,
        format: 'json',
        origin: '*'
      };

      displayLoading(true); // show loading state

      $.ajax({
        url: url,
        data: data,
        method: 'GET',
        success: function (res) {
          $('ul').empty();
          const results = res.query.search;
          results.forEach(result => {
            addNewArticle(result.pageid, result.title, result.snippet);
          });
        },
        complete: function () {
          // always runs after success or error
          displayLoading(false); // remove loading state
        }
      });
    }
    
    function displayLoading(loading) {
      const $ul = $('ul').first();
      if (loading) {
        if (!$ul.parent().hasClass('loading'))
          $ul.wrap('<div class="loading"></div>');
      } else {
        if ($ul.parent().hasClass('loading')) {
          $ul.unwrap();
        }
    }
  }
    
    $(document).ready(function () {
      createSearchForm();
    });



        

  </script>
</body>

</html>
